const Web3 = require('web3');
const web3 = new Web3('http://192.168.0.184:8545'); //   Geth node URL
const contractABI = [
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_validator",
				"type": "address"
			}
		],
		"name": "addValidator",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "productId",
				"type": "uint256"
			},
			{
				"indexed": true,
				"internalType": "string",
				"name": "productName",
				"type": "string"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "manufacturer",
				"type": "address"
			}
		],
		"name": "ProductRegistered",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "productId",
				"type": "uint256"
			}
		],
		"name": "ProductVerified",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_productName",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_manufacturingLocation",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_batchNumber",
				"type": "string"
			}
		],
		"name": "registerProduct",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_productId",
				"type": "uint256"
			}
		],
		"name": "verifyProduct",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "admin",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_productId",
				"type": "uint256"
			}
		],
		"name": "getProduct",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "products",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "productId",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "productName",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "manufacturer",
				"type": "address"
			},
			{
				"internalType": "string",
				"name": "manufacturingLocation",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "batchNumber",
				"type": "string"
			},
			{
				"internalType": "bool",
				"name": "isVerified",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "validators",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]; // ABI of your smart contract
const contractBytecode = "0x608060405234801561001057600080fd5b5033600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506001806000600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908315150217905550611751806100da6000396000f3fe608060405234801561001057600080fd5b506004361061007d5760003560e01c80637acc0b201161005b5780637acc0b20146100ea578063b9db15b41461011f578063f851a44014610154578063fa52c7d8146101725761007d565b80633406b718146100825780634d238c8e146100b2578063524e8462146100ce575b600080fd5b61009c60048036038101906100979190610cf9565b6101a2565b6040516100a99190610db9565b60405180910390f35b6100cc60048036038101906100c79190610e32565b610401565b005b6100e860048036038101906100e39190610e8b565b6104eb565b005b61010460048036038101906100ff9190610e8b565b61068f565b60405161011696959493929190610f61565b60405180910390f35b61013960048036038101906101349190610e8b565b610890565b60405161014b96959493929190610f61565b60405180910390f35b61015c610b59565b6040516101699190610fd7565b60405180910390f35b61018c60048036038101906101879190610e32565b610b7f565b6040516101999190610ff2565b60405180910390f35b6000808451116101e7576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101de90611059565b60405180910390fd5b600083511161022b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610222906110eb565b60405180910390fd5b600082511161026f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161026690611157565b60405180910390fd5b600060025490506040518060c001604052808281526020018681526020013373ffffffffffffffffffffffffffffffffffffffff168152602001858152602001848152602001600015158152506000808381526020019081526020016000206000820151816000015560208201518160010190816102ed9190611383565b5060408201518160020160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550606082015181600301908161034a9190611383565b5060808201518160040190816103609190611383565b5060a08201518160050160006101000a81548160ff0219169083151502179055509050506002600081548092919061039790611484565b91905055503373ffffffffffffffffffffffffffffffffffffffff16856040516103c19190611508565b6040518091039020827fd810998a0248808a33b20218e71759cb2ec1a182b398350ad606d742587c012c60405160405180910390a4809150509392505050565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610491576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161048890611591565b60405180910390fd5b60018060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff02191690831515021790555050565b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16610577576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161056e90611623565b60405180910390fd5b8060008083815260200190815260200160002060000154146105ce576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016105c59061168f565b60405180910390fd5b60008082815260200190815260200160002060050160009054906101000a900460ff1615610631576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610628906116fb565b60405180910390fd5b600160008083815260200190815260200160002060050160006101000a81548160ff021916908315150217905550807f0ab290ee6a838866b5914ddc6bcd48309b8be846b045bd971b132e6b9cbe2f0760405160405180910390a250565b60006020528060005260406000206000915090508060000154908060010180546106b8906111a6565b80601f01602080910402602001604051908101604052809291908181526020018280546106e4906111a6565b80156107315780601f1061070657610100808354040283529160200191610731565b820191906000526020600020905b81548152906001019060200180831161071457829003601f168201915b5050505050908060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169080600301805461076c906111a6565b80601f0160208091040260200160405190810160405280929190818152602001828054610798906111a6565b80156107e55780601f106107ba576101008083540402835291602001916107e5565b820191906000526020600020905b8154815290600101906020018083116107c857829003601f168201915b5050505050908060040180546107fa906111a6565b80601f0160208091040260200160405190810160405280929190818152602001828054610826906111a6565b80156108735780601f1061084857610100808354040283529160200191610873565b820191906000526020600020905b81548152906001019060200180831161085657829003601f168201915b5050505050908060050160009054906101000a900460ff16905086565b60006060600060608060008660008089815260200190815260200160002060000154146108f2576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108e99061168f565b60405180910390fd5b600080888152602001908152602001600020600001546000808981526020019081526020016000206001016000808a815260200190815260200160002060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166000808b81526020019081526020016000206003016000808c81526020019081526020016000206004016000808d815260200190815260200160002060050160009054906101000a900460ff168480546109ac906111a6565b80601f01602080910402602001604051908101604052809291908181526020018280546109d8906111a6565b8015610a255780601f106109fa57610100808354040283529160200191610a25565b820191906000526020600020905b815481529060010190602001808311610a0857829003601f168201915b50505050509450828054610a38906111a6565b80601f0160208091040260200160405190810160405280929190818152602001828054610a64906111a6565b8015610ab15780601f10610a8657610100808354040283529160200191610ab1565b820191906000526020600020905b815481529060010190602001808311610a9457829003601f168201915b50505050509250818054610ac4906111a6565b80601f0160208091040260200160405190810160405280929190818152602001828054610af0906111a6565b8015610b3d5780601f10610b1257610100808354040283529160200191610b3d565b820191906000526020600020905b815481529060010190602001808311610b2057829003601f168201915b5050505050915095509550955095509550955091939550919395565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60016020528060005260406000206000915054906101000a900460ff1681565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b610c0682610bbd565b810181811067ffffffffffffffff82111715610c2557610c24610bce565b5b80604052505050565b6000610c38610b9f565b9050610c448282610bfd565b919050565b600067ffffffffffffffff821115610c6457610c63610bce565b5b610c6d82610bbd565b9050602081019050919050565b82818337600083830152505050565b6000610c9c610c9784610c49565b610c2e565b905082815260208101848484011115610cb857610cb7610bb8565b5b610cc3848285610c7a565b509392505050565b600082601f830112610ce057610cdf610bb3565b5b8135610cf0848260208601610c89565b91505092915050565b600080600060608486031215610d1257610d11610ba9565b5b600084013567ffffffffffffffff811115610d3057610d2f610bae565b5b610d3c86828701610ccb565b935050602084013567ffffffffffffffff811115610d5d57610d5c610bae565b5b610d6986828701610ccb565b925050604084013567ffffffffffffffff811115610d8a57610d89610bae565b5b610d9686828701610ccb565b9150509250925092565b6000819050919050565b610db381610da0565b82525050565b6000602082019050610dce6000830184610daa565b92915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000610dff82610dd4565b9050919050565b610e0f81610df4565b8114610e1a57600080fd5b50565b600081359050610e2c81610e06565b92915050565b600060208284031215610e4857610e47610ba9565b5b6000610e5684828501610e1d565b91505092915050565b610e6881610da0565b8114610e7357600080fd5b50565b600081359050610e8581610e5f565b92915050565b600060208284031215610ea157610ea0610ba9565b5b6000610eaf84828501610e76565b91505092915050565b600081519050919050565b600082825260208201905092915050565b60005b83811015610ef2578082015181840152602081019050610ed7565b60008484015250505050565b6000610f0982610eb8565b610f138185610ec3565b9350610f23818560208601610ed4565b610f2c81610bbd565b840191505092915050565b610f4081610df4565b82525050565b60008115159050919050565b610f5b81610f46565b82525050565b600060c082019050610f766000830189610daa565b8181036020830152610f888188610efe565b9050610f976040830187610f37565b8181036060830152610fa98186610efe565b90508181036080830152610fbd8185610efe565b9050610fcc60a0830184610f52565b979650505050505050565b6000602082019050610fec6000830184610f37565b92915050565b60006020820190506110076000830184610f52565b92915050565b7f50726f64756374206e616d65206d7573742062652070726f7669646564000000600082015250565b6000611043601d83610ec3565b915061104e8261100d565b602082019050919050565b6000602082019050818103600083015261107281611036565b9050919050565b7f4d616e75666163747572696e67206c6f636174696f6e206d757374206265207060008201527f726f766964656400000000000000000000000000000000000000000000000000602082015250565b60006110d5602783610ec3565b91506110e082611079565b604082019050919050565b60006020820190508181036000830152611104816110c8565b9050919050565b7f4261746368206e756d626572206d7573742062652070726f7669646564000000600082015250565b6000611141601d83610ec3565b915061114c8261110b565b602082019050919050565b6000602082019050818103600083015261117081611134565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806111be57607f821691505b6020821081036111d1576111d0611177565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026112397fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826111fc565b61124386836111fc565b95508019841693508086168417925050509392505050565b6000819050919050565b600061128061127b61127684610da0565b61125b565b610da0565b9050919050565b6000819050919050565b61129a83611265565b6112ae6112a682611287565b848454611209565b825550505050565b600090565b6112c36112b6565b6112ce818484611291565b505050565b5b818110156112f2576112e76000826112bb565b6001810190506112d4565b5050565b601f82111561133757611308816111d7565b611311846111ec565b81016020851015611320578190505b61133461132c856111ec565b8301826112d3565b50505b505050565b600082821c905092915050565b600061135a6000198460080261133c565b1980831691505092915050565b60006113738383611349565b9150826002028217905092915050565b61138c82610eb8565b67ffffffffffffffff8111156113a5576113a4610bce565b5b6113af82546111a6565b6113ba8282856112f6565b600060209050601f8311600181146113ed57600084156113db578287015190505b6113e58582611367565b86555061144d565b601f1984166113fb866111d7565b60005b82811015611423578489015182556001820191506020850194506020810190506113fe565b86831015611440578489015161143c601f891682611349565b8355505b6001600288020188555050505b505050505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600061148f82610da0565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82036114c1576114c0611455565b5b600182019050919050565b600081905092915050565b60006114e282610eb8565b6114ec81856114cc565b93506114fc818560208601610ed4565b80840191505092915050565b600061151482846114d7565b915081905092915050565b7f4f6e6c792061646d696e2063616e20706572666f726d2074686973206f70657260008201527f6174696f6e000000000000000000000000000000000000000000000000000000602082015250565b600061157b602583610ec3565b91506115868261151f565b604082019050919050565b600060208201905081810360008301526115aa8161156e565b9050919050565b7f4f6e6c792076616c696461746f72732063616e20706572666f726d207468697360008201527f206f7065726174696f6e00000000000000000000000000000000000000000000602082015250565b600061160d602a83610ec3565b9150611618826115b1565b604082019050919050565b6000602082019050818103600083015261163c81611600565b9050919050565b7f496e76616c69642070726f647563742049440000000000000000000000000000600082015250565b6000611679601283610ec3565b915061168482611643565b602082019050919050565b600060208201905081810360008301526116a88161166c565b9050919050565b7f50726f6475637420697320616c72656164792076657269666965640000000000600082015250565b60006116e5601b83610ec3565b91506116f0826116af565b602082019050919050565b60006020820190508181036000830152611714816116d8565b905091905056fea2646970667358221220361af60ae8d360c491593b0d87055483121c35b14fd5bdc5fef812bcac7b960d64736f6c63430008120033"; // Bytecode of the smart contract

// Define the account that will deploy the contract
const deployerAddress = "0xFb8F644164a4c77c5f3E1A0A01696DD91a6682E1"; // deployer's address
const deployerPrivateKey = "0x27d85d0d3586c64bb221a1d209bf340a3c70d8d1c593b6e338f812de700e3f13"; //  deployer's private key

// Create a contract instance
const MyContract = new web3.eth.Contract(contractABI);

// Deploy the contract
const deploy = async () => {
    const gasPrice = await web3.eth.getGasPrice();
    const gasEstimate = await MyContract.deploy({ data: contractBytecode }).estimateGas();
	const latestBlockNumber = await web3.eth.getBlockNumber();
	const balance = await web3.eth.getBalance('0xFb8F644164a4c77c5f3E1A0A01696DD91a6682E1'); // accnt address
	const networkId = await web3.eth.net.getId();
	const peerCount = await web3.eth.net.getPeerCount();
	const accounts = await web3.eth.getAccounts();

    const deployTransaction = await MyContract.deploy({
        data: contractBytecode,
    })
        .send({
            from: deployerAddress,
            gas: gasEstimate * 2,
            gasPrice: gasPrice * 2,
            value: "0", // Amount of ether to send
            nonce: await web3.eth.getTransactionCount(deployerAddress),
        })
        .on("transactionHash", (hash) => {
            console.log("Transaction Hash:", hash);
        });

    console.log("Contract Address:", deployTransaction.options.address); //ouput:0xE99d1d5756D9BC5DEA6959372d658AA0Fa59F617
	console.log('Latest Block Number:', latestBlockNumber);
	console.log('Gas Price:', gasPrice);
	console.log('Gas Estimate:',gasEstimate);
	console.log('Accounts:', accounts);
	console.log('Peer Count:', peerCount);
	console.log('Network ID:', networkId);
	console.log('Balance:', web3.utils.fromWei(balance, 'ether'), 'ETH');

};

deploy();
